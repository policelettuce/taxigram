# Design Document
## Функциональные детали
- Бот создан для поиска наиболее выгодного приложения такси
- Минимальное количество функций, доступных пользователю, для облегчения работы
- Реализован API Яндекс.Такси, т.к. остальные сервисы либо не предоставили свой интерфейс ввиду отсутствия ИП/ООО, либо не имеют такого вовсе.

## Структура проекта
### Общая логика
- Пользователь последовательно отправляет боту статичные геопозоиции. 
- Бот запоминает мировые координаты позиций, после чего формирует GET запрос и отправляет его на сервер такси. 
- Ответ от сервера приходит в формате JSON, из которого по ключевым данным получается цена поездки
- По ранее полученным мировым координатам формируется гиперссылка с быстрым доступом к назначенному маршруту в приложении.

### Логика хранения данных
В базе данных Taxigram существует одна таблица, хранящая в себе отправленные пользователями геопозиции для работы с ними:
| Название | Функционал |
| -------------- | -------------- |
| chat_id | Уникальный ID чата каждого пользователя бота |
| latitude_1 | Географическая ширина точки старта маршрута |
| longitude_1 | Географическая долгота точки старта маршрута |
| latitude_2 | Географическая ширина точки финиша маршрута|
| longitude_2 | Географическая долгота точки финиша маршрута |
| pointer | Указатель на то, какую точку в данный момент устанавливает пользователь - старт или финиш |

### Функции
| Название | Функционал |
| -------------- | -------------- |
| send_welcome | Обработка команды /start - приветствие |
| send_help | Обработка команды /help - помощь |
| check | Дебаггинг в консоли сервера (deprecated) |
| location | Обработка отправленной пользователем геопозиции, установка точки начала либо конца поездки (в зависимости от pointer) |
| buttons | Функционал кнопок в меню |
| switchto1 | Меняет величину pointer в БД для конкретного пользователя для последующей установки точки начала поездки |
| switchto2 | Аналогично switchto1, но для установки точки конца поездки |
| check_if_entry_exists | Проверяет, существует ли в БД строка с данными, соответствующая ID чата данного пользователя, и создает пустую строку при ее отсутствии |
| getcost | Формирование строки GET-запроса и обработка JSON, возвращает стоимость поездки |
| poserror | Обработка ситуаций с запросом стоимости при отсутствии геоданных |
| createlink | Создание гиперссылки для приложения такси |
| formatresult | Форматирование текста стоимости всех такси |
| keyborad | Keyboard markup |

### Интерфейс
Реализован с помощью кнопочного меню Telegram. Функионал:
- Выбор типа точки - задать начальную или конечную точку маршрута.
- Получить данные о стоимости.

![Interface picture](./interface2.png)

## План выполненния
- Основная работа с Telegram - создание обработки геопозиций, создание интерфейса, системы хранения данных
- Работа с API Яндекса - GET-запросы, работа с JSON
- Финальные штрихи - настройка вывода, ответов, внешний вид и т.д.
